<!-- The Top Bar -->

<header id="topbar-wrapper" class="flex-shrink-0" aria-label="Top Bar">
  <div
    id="topbar"
    class="d-flex align-items-center justify-content-between px-lg-3 h-100"
  >
    <!-- Custom Navigation Links -->
    <nav id="custom-nav" class="d-flex align-items-center gap-3">
      <a href="{{ '/' | relative_url }}" class="nav-link">Home</a>
      <a href="{{ '/categories/' | relative_url }}" class="nav-link">Categories</a>
      <a href="{{ '/tags/' | relative_url }}" class="nav-link">Tags</a>
      <a href="{{ '/archives/' | relative_url }}" class="nav-link">Archives</a>
      <a href="{{ '/about/' | relative_url }}" class="nav-link">About</a>
      
      <a href="{{ '/apps/' | relative_url }}" class="nav-link">Physics_Labs</a>
    </nav>

    <!-- Theme Switcher & Search Box -->
    <div class="d-flex align-items-center gap-2">
      <!-- Dummy button to satisfy native scripts -->
      <button id="mode-toggle" style="display: none;"></button>

      <button id="custom-mode-toggle" class="btn btn-link nav-link px-2" aria-label="Toggle Mode" style="border: none; background: transparent;">
        <i class="fas fa-sun"></i>
      </button>

      <search id="search" class="align-items-center ms-2">
        <i class="fas fa-search fa-fw"></i>
        <input
          class="form-control"
          id="search-input"
          type="search"
          aria-label="search"
          autocomplete="off"
          placeholder="{{ site.data.locales[include.lang].search.hint | capitalize }}..."
        >
      </search>
      <button type="button" class="btn btn-link text-decoration-none d-none" id="search-cancel">
        {{- site.data.locales[include.lang].search.cancel -}}
      </button>
    </div>
  </div>

  <script>
    (function() {
      const modeToggle = document.getElementById('custom-mode-toggle');
      if (!modeToggle) return;

      const html = document.documentElement;
      const icon = modeToggle.querySelector('i');

      function updateIcon(mode) {
        if (!icon) return;
        if (mode === 'dark') {
          icon.className = 'fas fa-moon';
        } else {
          icon.className = 'fas fa-sun';
        }
      }

      // Sync icon with current mode on load
      const initialMode = html.getAttribute('data-mode') || localStorage.getItem('mode') || 'light';
      updateIcon(initialMode);

      modeToggle.addEventListener('click', (e) => {
        e.preventDefault();
        const currentMode = html.getAttribute('data-mode') || 'light';
        const newMode = currentMode === 'dark' ? 'light' : 'dark';
        
        console.log('Switching to mode:', newMode);
        
        html.setAttribute('data-mode', newMode);
        localStorage.setItem('mode', newMode);
        updateIcon(newMode);
        
        // Signal background animation to update colors
        window.dispatchEvent(new Event('storage'));
      });

      // Listen for external mode changes (e.g. from other theme scripts)
      const observer = new MutationObserver((mutations) => {
        mutations.forEach((mutation) => {
          if (mutation.attributeName === 'data-mode') {
            updateIcon(html.getAttribute('data-mode'));
          }
        });
      });
      observer.observe(html, { attributes: true });
    })();
  </script>
</header>
