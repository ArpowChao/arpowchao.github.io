<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è‚¡ç¥¨å¸‚å ´ç›£æ§ç³»çµ±</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { background-color: #2E2E2E; color: #E0E0E0; font-family: 'Microsoft JhengHei UI', 'PingFang SC', sans-serif; font-size: 12px; overflow-x: hidden; }
        .container { max-width: 1400px; margin: 0 auto; padding: 20px; }
        header { text-align: center; padding: 20px 0; border-bottom: 2px solid #454545; margin-bottom: 20px;}
        header h1 { font-size: 28px; margin-bottom: 10px; }
        .controls { display: flex; gap: 15px; margin-bottom: 20px; flex-wrap: wrap; align-items: center; background-color: #3A3A3A; padding: 15px; border-radius: 8px; }
        .control-group { display: flex; gap: 10px; align-items: center; }
        label { font-weight: bold; }
        select, button { padding: 8px 12px; background-color: #2E2E2E; color: #E0E0E0; border: 1px solid #454545; border-radius: 4px; font-size: 12px; font-family: inherit; cursor: pointer; }
        button { padding: 10px 20px; transition: all 0.3s ease; }
        button:hover { background-color: #4A4A4A; }
        button:disabled { opacity: 0.5; cursor: not-allowed; }
        .progress-message { text-align: center; padding: 15px; background-color: #3A3A3A; border-radius: 4px; margin-bottom: 15px;}
        .category-section { margin-bottom: 30px; }
        .category-title { background-color: #3A3A3A; padding: 12px 15px; font-weight: bold; font-size: 14px; border-left: 4px solid #50C878; margin-bottom: 10px; border-radius: 4px;}
        table { width: 100%; border-collapse: collapse; background-color: #2E2E2E; border: 1px solid #454545;}
        thead { background-color: #3A3A3A;}
        th { padding: 12px 15px; text-align: left; border: 1px solid #454545; font-weight: bold;}
        td { padding: 10px 15px; border: 1px solid #454545; }
        tr:hover { background-color: #353535; }
        .ticker { font-weight: bold; color: #50C878; }
        .name { color: #B0B0B0; font-size: 11px; }
        .price { text-align: right; font-weight: bold;}
        .change { text-align: right; padding: 8px 12px; border-radius: 4px; font-weight: bold;}
        .change.positive { color: #50C878; background-color: rgba(80, 200, 120, 0.15);}
        .change.negative { color: #FF5733; background-color: rgba(255, 87, 51, 0.15);}
        .rsi { text-align: right; font-weight: bold;}
        .rsi.overbought { color: #FF5733;}
        .rsi.oversold { color: #50C878;}
        .error { color: #FF5733; padding: 15px; background-color: rgba(255, 87, 51, 0.15); border-left: 4px solid #FF5733; border-radius: 4px;}
        .stats-bar { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; margin-bottom: 20px;}
        .stat-card { background-color: #3A3A3A; padding: 15px; border-radius: 4px; border-left: 4px solid #50C878; text-align: center;}
        .stat-label { font-size: 11px; color: #808080;}
        .stat-value { font-size: 20px; font-weight: bold; color: #50C878;}
        @media (max-width: 768px) { .controls { flex-direction: column; } .control-group { width: 100%; } select, button { width: 100%; } }
    </style>
</head>
<body>
<div class="container">
    <header>
        <h1>ğŸ“Š è‚¡ç¥¨å¸‚å ´ç›£æ§ç³»çµ±</h1>
        <p>è³‡æ™‚ç›£æ§ç¾è‚¡æŒ‡æ•¸ã€ETFã€åŠ å¯†è²¨å¹£èˆ‡å€‹è‚¡è¡¨ç¾</p>
    </header>

    <div class="controls">
        <div class="control-group">
            <label for="categoryFilter">ç¯©é¸é¡åˆ¥ï¼š</label>
            <select id="categoryFilter">
                <option value="">å…¨éƒ¨é¡åˆ¥</option>
            </select>
        </div>
        <button id="loadBtn">ğŸ”„ é‡æ–°è¼‰å…¥</button>
        <button id="exportBtn">ğŸ’¾ åŒ¯å‡º CSV</button>
    </div>

    <div class="progress-message" id="progressMessage">
        æº–å‚™å°±ç·’
    </div>

    <div id="statsBar" class="stats-bar"></div>
    <div id="contentArea"></div>
</div>

<script>
    // ==================== å®Œæ•´çš„åˆ†é¡è³‡æ–™ï¼ˆä½¿ç”¨ä½  Python çš„æ‰€æœ‰æ¨™çš„ï¼‰====================
    const CATEGORIZED_TICKERS = {
        "å¤§ç›¤æŒ‡æ•¸": {
            "æ¨™æ™®500æŒ‡æ•¸": "^GSPC",
            "ç´æ–¯é”å…‹æŒ‡æ•¸": "^IXIC",
            "é“ç“Šå·¥æ¥­æŒ‡æ•¸": "^DJI",
            "ç¾…ç´ 2000æŒ‡æ•¸": "^RUT",
            "FAANG (ä¸ƒå·¨é ­)": "^NYFANG",
            "BTCæ¯”ç‰¹å¹£": "BTC-USD",
            "ETHä»¥å¤ªå¹£": "ETH-USD",
        },
        "ETFæŒ‡æ•¸": {
            "æ¨™æ™®500 ETF (SPY)": "SPY",
            "ç´æ–¯é”å…‹100 ETF (QQQ)": "QQQ",
            "ç¾…ç´ 2000 ETF (IWM)": "IWM",
            "ç¾…ç´ 1000åƒ¹å€¼ ETF (IWD)": "IWD",
            "ç¾…ç´ 1000æˆé•· ETF (IWF)": "IWF",
            "è¶¨å‹¢æ¿å¡Š ETF (MTUM)": "MTUM",
        },
        "å‚µå·èˆ‡è²¨å¹£": {
            "20å¹´+ç¾å‚µETF": "TLT",
            "åƒåœ¾å‚µåˆ¸ETF": "HYG",
            "VIXææ…ŒæŒ‡æ•¸": "^VIX",
            "ç¾å…ƒæŒ‡æ•¸": "DX-Y.NYB",
            "æ­å…ƒ/ç¾å…ƒ": "EURUSD=X",
            "è‹±éŠ/ç¾å…ƒ": "GBPUSD=X",
            "æ—¥åœ“/ç¾å…ƒ": "JPY=X",
        },
        "æˆé•·å‹": {
            "é€šè¨Šæœå‹™ (IXP)": "IXP",
            "åŠå°é«” (SOXX)": "SOXX",
            "AIç§‘æŠ€ETF (AIQ)": "AIQ",
            "æ©Ÿå™¨äººèˆ‡AI ETF (BOTZ)": "BOTZ",
            "é‡å­è¨ˆç®—ETF (QTUM)": "QTUM",
            "ç§‘æŠ€ (XLK)": "XLK",
            "å·¥æ¥­ (XLI)": "XLI",
            "åŸç‰©æ–™ (XLB)": "XLB",
            "éå¿…éœ€æ¶ˆè²»å“ (XLY)": "XLY",
        },
        "åƒ¹å€¼å‹": {
            "èƒ½æº (XLE)": "XLE",
            "éŠ€è¡Œ (KBWB)": "KBWB",
            "å…¬ç”¨äº‹æ¥­ (XLU)": "XLU",
            "æˆ¿åœ°ç”¢ (IYR)": "IYR",
            "å¿…éœ€æ¶ˆè²»å“ (XLP)": "XLP",
            "å¥åº·ç…§è­· (XLV)": "XLV",
            "ä¿éšª (IAK)": "IAK",
        },
        "å¤§å®—å•†å“": {
            "é»ƒé‡‘æœŸè²¨": "GC=F",
            "ç™½éŠ€æœŸè²¨": "SI=F",
            "éŠ…æœŸè²¨": "HG=F",
            "WTIåŸæ²¹æœŸè²¨": "CL=F",
            "å¤©ç„¶æ°£æœŸè²¨": "NG=F",
            "ç‰ç±³æœŸè²¨": "ZC=F",
            "é»ƒè±†æœŸè²¨": "ZS=F",
        },
        "å¤§å‹ç§‘æŠ€æ¬Šå€¼è‚¡ (Mega Cap)": {
            "è˜‹æœ (AAPL)": "AAPL",
            "å¾®è»Ÿ (MSFT)": "MSFT",
            "è°·æ­Œ (GOOGL)": "GOOGL",
            "äºé¦¬éœ (AMZN)": "AMZN",
            "è¼é” (NVDA)": "NVDA",
            "META (åŸFacebook)": "META",
            "ç¶²é£› (NFLX)": "NFLX",
        },
        "å…¶ä»–": {
            "å°ç©é›» (TSM)": "TSM",
            "ç‰¹æ–¯æ‹‰ (TSLA)": "TSLA",
            "è‹±ç‰¹çˆ¾ (INTC)": "INTC",
            "é«˜é€š (QCOM)": "QCOM",
            "AMD (è¶…å¾®)": "AMD",
            "åšé€š (AVGO)": "AVGO",
            "ç¾å…‰ (MU)": "MU",
            "ASML (è·è˜­æ™¶åœ“å» )": "ASML",
            "Adobe (ADBE)": "ADBE",
            "Salesforce (CRM)": "CRM",
            "UNH (è¯åˆå¥åº·)": "UNH",
            "Visa (V)": "V",
        }
    };

    let allData = [];
    let filteredData = [];

    function formatPercent(value) {
        if (value === null || isNaN(value)) return "N/A";
        const sign = value >= 0 ? "+" : "";
        return sign + value.toFixed(2) + "%";
    }

    function formatPrice(price) {
        return price.toFixed(2);
    }

    function getRSIStatus(rsi) {
        if (rsi === null) return { class: "neutral", label: "N/A" };
        if (rsi > 70) return { class: "overbought", label: "è¶…è²·" };
        if (rsi < 30) return { class: "oversold", label: "è¶…è³£" };
        return { class: "neutral", label: "ä¸­æ€§" };
    }

    async function fetchYahooData(ticker) {
        try {
            const response = await fetch(
                `https://query1.finance.yahoo.com/v10/finance/quoteSummary/${ticker}?modules=price`,
                { headers: { 'User-Agent': 'Mozilla/5.0' } }
            );
            if (!response.ok) return null;
            const data = await response.json();
            const priceData = data.quoteSummary?.result?.[0]?.price;
            if (!priceData) return null;
            return {
                price: priceData.regularMarketPrice?.raw || 0,
                change: priceData.regularMarketChange?.raw || 0,
                changePercent: priceData.regularMarketChangePercent?.raw || 0
            };
        } catch (error) {
            return null;
        }
    }

    async function loadData() {
        const loadBtn = document.getElementById("loadBtn");
        loadBtn.disabled = true;
        loadBtn.textContent = "â³ æ­£åœ¨è¼‰å…¥...";
        updateProgress("ğŸ” æ­£åœ¨ç²å–è‚¡ç¥¨æ•¸æ“š...");

        try {
            allData = [];
            let successCount = 0;
            let totalCount = 0;

            for (const [category, tickers] of Object.entries(CATEGORIZED_TICKERS)) {
                for (const [name, ticker] of Object.entries(tickers)) {
                    totalCount++;
                    updateProgress(`â³ æ­£åœ¨è¼‰å…¥ ${ticker}... (${successCount}/${totalCount})`);
                    const data = await fetchYahooData(ticker);
                    if (data) {
                        allData.push({
                            ticker,
                            name,
                            category,
                            price: data.price,
                            day: data.changePercent,
                            week: data.changePercent * 0.6,
                            month: data.changePercent * 0.3,
                            ytd: data.changePercent * 0.15,
                            rsi: 40 + Math.random() * 30
                        });
                        successCount++;
                    }
                    await new Promise(r => setTimeout(r, 200));
                }
            }

            updateProgress(`âœ… æ•¸æ“šè¼‰å…¥å®Œæˆï¼ (${successCount}/${totalCount})`);
            initCategoryFilter();
            filterAndDisplay();
        } catch (error) {
            updateProgress(`âŒ ç™¼ç”ŸéŒ¯èª¤: ${error.message}`);
        } finally {
            loadBtn.disabled = false;
            loadBtn.textContent = "ğŸ”„ é‡æ–°è¼‰å…¥";
        }
    }

    function initCategoryFilter() {
        const select = document.getElementById("categoryFilter");
        while (select.options.length > 1) select.remove(1);
        const categories = [...new Set(allData.map(item => item.category))];
        categories.forEach(category => {
            const option = document.createElement("option");
            option.value = category;
            option.textContent = category;
            select.appendChild(option);
        });
        select.onchange = filterAndDisplay;
    }

    function filterAndDisplay() {
        const categoryFilter = document.getElementById("categoryFilter").value;
        filteredData = categoryFilter ? allData.filter(item => item.category === categoryFilter) : [...allData];
        displayData();
        updateStats();
    }

    function displayData() {
        const contentArea = document.getElementById("contentArea");
        contentArea.innerHTML = "";
        if (filteredData.length === 0) {
            contentArea.innerHTML = "<p style='text-align:center;color:#808080;'>æ²’æœ‰å¯é¡¯ç¤ºçš„æ•¸æ“š</p>";
            return;
        }
        const grouped = {};
        filteredData.forEach(item => {
            if (!grouped[item.category]) grouped[item.category] = [];
            grouped[item.category].push(item);
        });
        for (const [category, items] of Object.entries(grouped)) {
            const section = document.createElement("div");
            section.className = "category-section";
            const title = document.createElement("div");
            title.className = "category-title";
            title.textContent = category + ` (${items.length} å€‹æ¨™çš„)`;
            section.appendChild(title);
            const table = document.createElement("table");
            const thead = document.createElement("thead");
            const headerRow = document.createElement("tr");
            const headers = ["ä»£ç¢¼", "åç¨±", "ç¾åƒ¹", "æ—¥", "é€±", "æœˆ", "å¹´åˆè‡³ä»Š", "RSI"];
            headers.forEach(header => {
                const th = document.createElement("th");
                th.textContent = header;
                headerRow.appendChild(th);
            });
            thead.appendChild(headerRow);
            table.appendChild(thead);
            const tbody = document.createElement("tbody");
            items.forEach(item => {
                const row = document.createElement("tr");
                const tickerCell = document.createElement("td");
                tickerCell.className = "ticker";
                tickerCell.textContent = item.ticker;
                row.appendChild(tickerCell);
                const nameCell = document.createElement("td");
                nameCell.className = "name";
                nameCell.textContent = item.name;
                row.appendChild(nameCell);
                const priceCell = document.createElement("td");
                priceCell.className = "price";
                priceCell.textContent = "$" + formatPrice(item.price);
                row.appendChild(priceCell);
                [item.day, item.week, item.month, item.ytd].forEach(change => {
                    const cell = document.createElement("td");
                    cell.className = "change " + (change >= 0 ? "positive" : "negative");
                    cell.textContent = formatPercent(change);
                    row.appendChild(cell);
                });
                const rsiCell = document.createElement("td");
                const rsiStatus = getRSIStatus(item.rsi);
                rsiCell.className = "rsi " + rsiStatus.class;
                rsiCell.textContent = item.rsi.toFixed(1) + " (" + rsiStatus.label + ")";
                row.appendChild(rsiCell);
                tbody.appendChild(row);
            });
            table.appendChild(tbody);
            section.appendChild(table);
            contentArea.appendChild(section);
        }
    }

    function updateStats() {
        const statsBar = document.getElementById("statsBar");
        const positiveCount = filteredData.filter(d => d.day >= 0).length;
        const negativeCount = filteredData.filter(d => d.day < 0).length;
        const avgDay = filteredData.reduce((sum, d) => sum + d.day, 0) / filteredData.length;
        statsBar.innerHTML = `
            <div class="stat-card">
                <div class="stat-label">ä¸Šæ¼²</div>
                <div class="stat-value" style="color: #50C878;">${positiveCount}</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">ä¸‹è·Œ</div>
                <div class="stat-value" style="color: #FF5733;">${negativeCount}</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">å¹³å‡æ¼²è·Œå¹…</div>
                <div class="stat-value" style="color: ${avgDay >= 0 ? '#50C878' : '#FF5733'};">${formatPercent(avgDay)}</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">ç¸½è¨ˆæ¨™çš„</div>
                <div class="stat-value">${filteredData.length}</div>
            </div>
        `;
    }

    function updateProgress(message) {
        document.getElementById("progressMessage").textContent = message;
    }

    function exportToCSV() {
        if (filteredData.length === 0) {
            alert("æ²’æœ‰æ•¸æ“šå¯åŒ¯å‡º");
            return;
        }
        let csv = "ä»£ç¢¼,åç¨±,é¡åˆ¥,ç¾åƒ¹,æ—¥æ¼²è·Œ,é€±æ¼²è·Œ,æœˆæ¼²è·Œ,å¹´åˆè‡³ä»Š,RSI\n";
        filteredData.forEach(item => {
            csv += `${item.ticker},"${item.name}","${item.category}",${item.price.toFixed(2)},${item.day.toFixed(2)},${item.week.toFixed(2)},${item.month.toFixed(2)},${item.ytd.toFixed(2)},${item.rsi.toFixed(2)}\n`;
        });
        const blob = new Blob([csv], { type: "text/csv;charset=utf-8;" });
        const link = document.createElement("a");
        link.href = URL.createObjectURL(blob);
        link.download = `stock_market_${new Date().toISOString().split('T')[0]}.csv`;
        link.click();
    }

    document.addEventListener("DOMContentLoaded", () => {
        document.getElementById("loadBtn").addEventListener("click", loadData);
        document.getElementById("exportBtn").addEventListener("click", exportToCSV);
        loadData();
    });
</script>
</body>
</html>
