<!DOCTYPE html><html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>隨機數值抽樣(機率同)產生器</title>
    <!-- 引入 Chart.js 函式庫 -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* --- 整體風格 --- */
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background-color: #f0f2f5;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            padding: 40px 20px;
            min-height: 100vh;
            margin: 0;
            box-sizing: border-box;
        }

        /* --- 主容器 --- */
        .container {
            width: 100%;
            max-width: 600px;
            background-color: #ffffff;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        h1 {
            text-align: center;
            color: #1c1e21;
            margin-top: 0;
            margin-bottom: 30px;
        }

        /* --- 設定區塊 --- */
        .controls {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 25px;
        }

        .control-group {
            display: flex;
            flex-direction: column;
        }
        
        .control-group.full-width {
            grid-column: 1 / -1;
        }

        label {
            font-weight: 600;
            color: #606770;
            margin-bottom: 8px;
        }

        input[type="number"],
        input[type="radio"] {
            font-size: 16px;
        }
        
        input[type="number"] {
            padding: 10px;
            border: 1px solid #ccd0d5;
            border-radius: 6px;
            outline: none;
            transition: border-color 0.2s, box-shadow 0.2s;
        }
        
        input[type="number"]:focus {
            border-color: #1877f2;
            box-shadow: 0 0 0 2px rgba(24, 119, 242, 0.2);
        }

        .radio-group {
            display: flex;
            gap: 20px;
            align-items: center;
            padding-top: 5px;
        }
        
        .radio-group label {
            font-weight: normal;
            margin: 0;
        }

        /* --- 按鈕與狀態 --- */
        button {
            width: 100%;
            padding: 12px;
            font-size: 18px;
            font-weight: bold;
            color: #fff;
            background-color: #1877f2;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        button:hover {
            background-color: #166fe5;
        }
        
        button:disabled {
            background-color: #a0bdf1;
            cursor: not-allowed;
        }
        
        #generateBtn {
             margin-bottom: 15px;
        }

        #statusMessage {
            text-align: center;
            font-weight: 600;
            height: 20px;
            color: #606770;
        }

        /* --- 結果區塊 --- */
        .results {
            margin-top: 20px;
        }

        #summaryStats {
            display: flex;
            justify-content: space-around;
            flex-wrap: wrap; /* 允許換行 */
            padding: 15px;
            background-color: #f7f8fa;
            border-radius: 8px;
            margin-bottom: 20px;
            gap: 10px;
        }
        
        #summaryStats p {
            margin: 0;
            font-size: 16px;
            color: #1c1e21;
            text-align: center;
        }
        
        #summaryStats span {
            font-weight: bold;
            font-family: monospace;
            font-size: 18px;
            display: block; /* 讓 span 獨佔一行 */
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            text-align: center;
        }

        th, td {
            padding: 12px 10px;
            border: 1px solid #e9ebee;
        }

        thead {
            background-color: #f5f6f7;
            font-weight: 600;
            color: #4b4f56;
        }

        /* --- 新增：統計圖容器樣式 --- */
        .chart-container {
            position: relative;
            margin: 30px 0;
            height: 300px;
        }

        /* --- Raw Data 區塊的新樣式 --- */
        .secondary-button {
            background-color: #e4e6eb;
            color: #4b4f56;
            margin-top: 20px;
            font-size: 16px;
        }

        .secondary-button:hover {
            background-color: #d8dbdf;
        }

        #rawDataOutput {
            width: 100%;
            height: 150px;
            margin-top: 15px;
            padding: 10px;
            border: 1px solid #ccd0d5;
            border-radius: 6px;
            font-family: monospace;
            font-size: 14px;
            resize: vertical;
            display: none; /* 預設隱藏 */
            box-sizing: border-box;
        }
    </style>
</head>
<body>
    <a href="index.html" style="position: fixed; top: 20px; left: 20px; padding: 10px 15px; background-color: #007bff; color: white; text-decoration: none; border-radius: 5px; z-index: 1000;">回首頁</a>

    <div class="container">
        <h1>隨機數值抽樣(機率同)產生器</h1>

        <div class="controls">
            <!-- ... (輸入控制項與之前相同) ... -->
            <div class="control-group full-width">
                <label for="numPointsInput">生成數量 (1 - 1,000,000)</label>
                <input type="number" id="numPointsInput" value="10000" min="1" max="1000000">
            </div>
            <div class="control-group">
                <label for="minRangeInput">數值下限 (Min)</label>
                <input type="number" id="minRangeInput" value="1">
            </div>
            <div class="control-group">
                <label for="maxRangeInput">數值上限 (Max)</label>
                <input type="number" id="maxRangeInput" value="10">
            </div>
            <div class="control-group full-width">
                <label>數字類型</label>
                <div class="radio-group">
                    <input type="radio" name="numberType" id="typeFloat" value="float">
                    <label for="typeFloat">隨機數(包含小數)</label>
                    <input type="radio" name="numberType" id="typeInt" value="int" checked>
                    <label for="typeInt">隨機整數(撲克牌模式)</label>
                </div>
            </div>
        </div>

        <button id="generateBtn">生成數據</button>
        <p id="statusMessage"></p>

        <div class="results" id="resultsContainer" style="display: none;">
            <div id="summaryStats">
                <p>平均值<span id="meanValue">-</span></p>
                <p>標準差<span id="stdDevValue">-</span></p>
                <p>統計範圍<span id="rangeValue">-</span></p>
            </div>
            
            <!-- 新增的統計圖畫布 -->
            <div class="chart-container">
                <canvas id="statsChart"></canvas>
            </div>

            <table>
                <thead>
                    <tr>
                        <th>數值範圍</th>
                        <th>出現次數</th>
                        <th>百分比</th>
                    </tr>
                </thead>
                <tbody id="statsTableBody">
                </tbody>
            </table>
            
            <button id="toggleRawDataBtn" class="secondary-button">顯示 Raw Data</button>
            <textarea id="rawDataOutput" readonly></textarea>
        </div>
    </div>

    <script>
        const generateBtn = document.getElementById('generateBtn');
        const statusMessage = document.getElementById('statusMessage');
        const resultsContainer = document.getElementById('resultsContainer');
        const toggleRawDataBtn = document.getElementById('toggleRawDataBtn');
        const rawDataOutput = document.getElementById('rawDataOutput');
        
        let myChart = null; // 用來存放 Chart.js 的實例

        generateBtn.addEventListener('click', main);
        toggleRawDataBtn.addEventListener('click', () => {
            const isHidden = rawDataOutput.style.display === 'none';
            if (isHidden) {
                rawDataOutput.style.display = 'block';
                toggleRawDataBtn.textContent = '隱藏 Raw Data';
            } else {
                rawDataOutput.style.display = 'none';
                toggleRawDataBtn.textContent = '顯示 Raw Data';
            }
        });

        function main() {
            // ... (獲取輸入 & 驗證) ...
            const numPoints = parseInt(document.getElementById('numPointsInput').value);
            const min = parseFloat(document.getElementById('minRangeInput').value);
            const max = parseFloat(document.getElementById('maxRangeInput').value);
            const type = document.querySelector('input[name="numberType"]:checked').value;

            if (isNaN(numPoints) || numPoints < 1 || numPoints > 1000000 || isNaN(min) || isNaN(max) || min >= max) {
                statusMessage.textContent = "錯誤：請檢查輸入的數值是否正確 (下限需小於上限)。";
                statusMessage.style.color = "#d93025";
                return;
            }

            statusMessage.textContent = "處理中，請稍候...";
            statusMessage.style.color = "#606770";
            generateBtn.disabled = true;
            resultsContainer.style.display = 'none';

            setTimeout(() => {
                const data = [];
                for (let i = 0; i < numPoints; i++) {
                    let randomValue;
                    if (type === 'float') {
                        randomValue = Math.random() * (max - min) + min;
                    } else {
                        randomValue = Math.floor(Math.random() * (max - min + 1)) + min;
                    }
                    data.push(randomValue);
                }

                // ... (計算平均值 & 標準差) ...
                const sum = data.reduce((acc, val) => acc + val, 0);
                const mean = sum / numPoints;
                const squaredDiffs = data.map(val => Math.pow(val - mean, 2));
                const variance = squaredDiffs.reduce((acc, val) => acc + val, 0) / numPoints;
                const stdDev = Math.sqrt(variance);

                // --- NEW: 智慧型統計分組 (Binning) ---
                const bins = [];
                const range = max - min;
                let statisticalRangeString = '';

                if (type === 'int' && range < 25) { // Case 1: 小範圍整數，每個整數為一組
                    statisticalRangeString = `${(min - 0.5).toFixed(1)} < x ≤ ${(max + 0.5).toFixed(1)}`;
                    for (let i = min; i <= max; i++) {
                        const label = `${i - 0.5} < x ≤ ${i + 0.5}`;
                        bins.push({ label: label, count: 0 });
                    }
                    data.forEach(value => {
                        const binIndex = value - min;
                        if (bins[binIndex] !== undefined) {
                            bins[binIndex].count++;
                        }
                    });

                } else if (type === 'int' && range >= 25) { // Case 2: 大範圍整數，分 10 組整數區間
                    const numBins = 10;
                    const binningMin = min - 0.5;
                    const binningMax = max + 0.5;
                    statisticalRangeString = `${binningMin.toFixed(2)} < x ≤ ${binningMax.toFixed(2)}`;
                    const span = binningMax - binningMin;
                    const groupSize = span / numBins;

                    for (let i = 0; i < numBins; i++) {
                        const currentBinMin = binningMin + i * groupSize;
                        let currentBinMax = currentBinMin + groupSize;
                        if(i === numBins - 1) {
                            currentBinMax = binningMax;
                        }
                        const label = `${currentBinMin.toFixed(2)} < x ≤ ${currentBinMax.toFixed(2)}`;
                        bins.push({ label: label, count: 0, max: currentBinMax });
                    }

                    data.forEach(value => {
                        for(let i = 0; i < bins.length; i++) {
                            if (value <= bins[i].max) {
                                bins[i].count++;
                                break;
                            }
                        }
                    });

                } else { // Case 3: 浮點數，分 10 組小數區間
                    statisticalRangeString = `${min.toFixed(2)} < x ≤ ${max.toFixed(2)}`;
                    const numBins = 10;
                    const binSize = (max - min) / numBins;
                    for (let i = 0; i < numBins; i++) {
                        const currentBinMin = min + i * binSize;
                        const currentBinMax = currentBinMin + binSize;
                        const label = `${currentBinMin.toFixed(2)} < x ≤ ${currentBinMax.toFixed(2)}`;
                        bins.push({ label: label, count: 0 });
                    }
                    data.forEach(value => {
                        if (value <= min) return;
                        const binIndex = Math.ceil((value - min) / binSize) - 1;
                        if (binIndex >= 0 && binIndex < numBins) {
                            bins[binIndex].count++;
                        }
                    });
                }


                // --- 渲染結果 ---
                document.getElementById('meanValue').textContent = mean.toFixed(4);
                document.getElementById('stdDevValue').textContent = stdDev.toFixed(4);
                document.getElementById('rangeValue').textContent = statisticalRangeString;
                rawDataOutput.value = data.join(', ');

                const tableBody = document.getElementById('statsTableBody');
                tableBody.innerHTML = '';
                bins.forEach(bin => {
                    const percentage = (bin.count / numPoints * 100).toFixed(2);
                    const row = `<tr><td>${bin.label}</td><td>${bin.count.toLocaleString()}</td><td>${percentage}%</td></tr>`;
                    tableBody.innerHTML += row;
                });
                
                // --- 渲染統計圖 ---
                const chartLabels = bins.map(b => b.label);
                const chartData = bins.map(b => b.count);
                renderChart(chartLabels, chartData);

                // --- 更新UI ---
                resultsContainer.style.display = 'block';
                statusMessage.textContent = `完成 ✓ (共生成 ${numPoints.toLocaleString()} 筆數據)`;
                statusMessage.style.color = "#4caf50";
                generateBtn.disabled = false;
                rawDataOutput.style.display = 'none';
                toggleRawDataBtn.textContent = '顯示 Raw Data';
            }, 50);
        }

        // --- 繪製圖表的函式 ---
        function renderChart(labels, data) {
            const ctx = document.getElementById('statsChart').getContext('2d');
            
            if (myChart) {
                myChart.destroy();
            }

            myChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: '出現次數',
                        data: data,
                        backgroundColor: 'rgba(24, 119, 242, 0.6)',
                        borderColor: 'rgba(24, 119, 242, 1)',
                        borderWidth: 1,
                        borderRadius: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: { display: true, text: '次數' }
                        },
                        x: { 
                            title: { display: true, text: '數值範圍' }
                        }
                    },
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `次數: ${context.raw.toLocaleString()}`;
                                }
                            }
                        }
                    }
                }
            });
        }
    </script>
</body>
</html>
