<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Online Whiteboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            overflow: hidden; /* Prevent scrolling */
        }
        /* Custom styles for better UX */
        .tool-btn.active {
            background-color: #3b82f6; /* blue-500 */
            color: white;
        }
        .color-option.active {
            transform: scale(1.2);
            box-shadow: 0 0 0 3px #3b82f6;
        }
    </style>
</head>
<body class="bg-gray-100 flex flex-col items-center justify-center">
    <a href="index.html" style="position: fixed; top: 20px; left: 20px; padding: 10px 15px; background-color: #007bff; color: white; text-decoration: none; border-radius: 5px; z-index: 1000;">回首頁</a>

    <!-- Whiteboard Canvas -->
    <canvas id="whiteboard" class="cursor-crosshair"></canvas>

    <!-- Toolbar -->
    <div id="toolbar" class="fixed top-4 bg-white shadow-lg rounded-full px-4 py-3 flex items-center space-x-4 z-10">
        <!-- Pen Tool -->
        <button id="pen-tool" class="tool-btn active p-2 rounded-full hover:bg-gray-200 transition-colors" title="Pen">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z"/></svg>
        </button>

        <!-- Eraser Tool -->
        <button id="eraser-tool" class="tool-btn p-2 rounded-full hover:bg-gray-200 transition-colors" title="Eraser">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m7 21-4.3-4.3c-1-1-1-2.5 0-3.4l9.6-9.6c1-1 2.5-1 3.4 0l5.6 5.6c1 1 1 2.5 0 3.4L13 21H7Z"/><path d="M22 21H7"/><path d="m5 12 5 5"/></svg>
        </button>
        
        <!-- Divider -->
        <div class="h-6 w-px bg-gray-300"></div>

        <!-- Brush Size -->
        <div class="flex items-center space-x-2" title="Brush Size">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/></svg>
            <input type="range" id="brush-size" min="1" max="50" value="5" class="w-24 cursor-pointer">
        </div>
        
        <!-- Divider -->
        <div class="h-6 w-px bg-gray-300"></div>
        
        <!-- Color Palette -->
        <div id="color-palette" class="flex items-center space-x-2">
            <button class="color-option active w-6 h-6 rounded-full bg-black border-2 border-white" data-color="#000000"></button>
            <button class="color-option w-6 h-6 rounded-full bg-red-500 border-2 border-white" data-color="#ef4444"></button>
            <button class="color-option w-6 h-6 rounded-full bg-blue-500 border-2 border-white" data-color="#3b82f6"></button>
            <button class="color-option w-6 h-6 rounded-full bg-green-500 border-2 border-white" data-color="#22c55e"></button>
            <button class="color-option w-6 h-6 rounded-full bg-yellow-400 border-2 border-white" data-color="#facc15"></button>
            <input type="color" id="color-picker" class="w-8 h-8 p-0 border-none bg-transparent cursor-pointer" title="Custom Color" value="#000000">
        </div>

        <!-- Divider -->
        <div class="h-6 w-px bg-gray-300"></div>
        
        <!-- Actions -->
        <button id="clear-canvas" class="p-2 rounded-full hover:bg-gray-200 transition-colors" title="Clear Canvas">
             <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/><line x1="10" x2="10" y1="11" y2="17"/><line x1="14" x2="14" y1="11" y2="17"/></svg>
        </button>
        <button id="save-image" class="p-2 rounded-full hover:bg-gray-200 transition-colors" title="Save as PNG">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" x2="12" y1="15" y2="3"/></svg>
        </button>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const canvas = document.getElementById('whiteboard');
            const ctx = canvas.getContext('2d');
            
            const toolbar = document.getElementById('toolbar');
            const penTool = document.getElementById('pen-tool');
            const eraserTool = document.getElementById('eraser-tool');
            const brushSizeSlider = document.getElementById('brush-size');
            const colorPalette = document.getElementById('color-palette');
            const customColorPicker = document.getElementById('color-picker');
            const clearButton = document.getElementById('clear-canvas');
            const saveButton = document.getElementById('save-image');

            let isDrawing = false;
            let isErasing = false;
            let lastX = 0;
            let lastY = 0;
            let brushSize = 5;
            let brushColor = '#000000';

            // Set canvas to full screen
            function resizeCanvas() {
                // Save current drawing
                const data = canvas.toDataURL();
                
                canvas.width = window.innerWidth;
                canvas.height = window.innerHeight;
                
                // Restore drawing
                const img = new Image();
                img.src = data;
                img.onload = () => {
                    ctx.drawImage(img, 0, 0);
                };

                // Set default background color
                ctx.fillStyle = '#f3f4f6'; // Same as bg-gray-100
                ctx.fillRect(0, 0, canvas.width, canvas.height);

            }
            
            window.addEventListener('resize', resizeCanvas);
            resizeCanvas();

            function startDrawing(e) {
                isDrawing = true;
                [lastX, lastY] = getMousePos(e);
            }

            function draw(e) {
                if (!isDrawing) return;
                
                const [currentX, currentY] = getMousePos(e);

                ctx.beginPath();
                ctx.moveTo(lastX, lastY);
                ctx.lineTo(currentX, currentY);

                if (isErasing) {
                    ctx.globalCompositeOperation = 'destination-out';
                    // Eraser size might be different
                    ctx.lineWidth = brushSize * 2; 
                } else {
                    ctx.globalCompositeOperation = 'source-over';
                    ctx.strokeStyle = brushColor;
                    ctx.lineWidth = brushSize;
                }
                
                ctx.lineCap = 'round';
                ctx.lineJoin = 'round';
                ctx.stroke();

                [lastX, lastY] = [currentX, currentY];
            }

            function stopDrawing() {
                isDrawing = false;
                ctx.beginPath();
            }

            function getMousePos(e) {
                // Handle both mouse and touch events
                if (e.touches) {
                    return [e.touches[0].clientX, e.touches[0].clientY];
                }
                return [e.clientX, e.clientY];
            }

            // Event Listeners for drawing
            canvas.addEventListener('mousedown', startDrawing);
            canvas.addEventListener('mousemove', draw);
            canvas.addEventListener('mouseup', stopDrawing);
            canvas.addEventListener('mouseleave', stopDrawing);
            
            canvas.addEventListener('touchstart', startDrawing);
            canvas.addEventListener('touchmove', draw);
            canvas.addEventListener('touchend', stopDrawing);


            // --- Toolbar Logic ---

            // Tool Selection
            penTool.addEventListener('click', () => {
                isErasing = false;
                penTool.classList.add('active');
                eraserTool.classList.remove('active');
                canvas.style.cursor = 'crosshair';
            });

            eraserTool.addEventListener('click', () => {
                isErasing = true;
                eraserTool.classList.add('active');
                penTool.classList.remove('active');
                canvas.style.cursor = `url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="${brushSize*2}" height="${brushSize*2}" viewBox="0 0 24 24" fill="none" stroke="black" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10" stroke="black" fill="white" /></svg>') ${brushSize} ${brushSize}, auto`;
            });
            
            // Brush Size
            brushSizeSlider.addEventListener('input', (e) => {
                brushSize = e.target.value;
                if (isErasing) {
                    // Update cursor for eraser
                    eraserTool.click();
                }
            });
            
            // Color Selection
            colorPalette.addEventListener('click', (e) => {
                if (e.target.dataset.color) {
                    brushColor = e.target.dataset.color;
                    
                    // Update active state
                    document.querySelectorAll('.color-option').forEach(btn => btn.classList.remove('active'));
                    e.target.classList.add('active');
                    
                    // Sync custom color picker
                    customColorPicker.value = brushColor;
                    
                    // Switch back to pen if a color is selected
                    penTool.click();
                }
            });

            customColorPicker.addEventListener('input', (e) => {
                 brushColor = e.target.value;
                 // Deselect any palette color
                 document.querySelectorAll('.color-option').forEach(btn => btn.classList.remove('active'));
                 penTool.click();
            });

            // Clear Canvas
            clearButton.addEventListener('click', () => {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                // Redraw background
                ctx.fillStyle = '#f3f4f6';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
            });

            // Save Image
            saveButton.addEventListener('click', () => {
                const link = document.createElement('a');
                // Create a temporary canvas to draw the background color before saving
                const tempCanvas = document.createElement('canvas');
                const tempCtx = tempCanvas.getContext('2d');
                tempCanvas.width = canvas.width;
                tempCanvas.height = canvas.height;
                // Draw the background color
                tempCtx.fillStyle = '#f3f4f6';
                tempCtx.fillRect(0, 0, tempCanvas.width, tempCanvas.height);
                // Draw the current canvas content on top
                tempCtx.drawImage(canvas, 0, 0);

                link.download = 'whiteboard.png';
                link.href = tempCanvas.toDataURL('image/png');
                link.click();
            });
        });
    </script>
</body>
</html>
